<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>農產履歷查詢</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css" />
    <link rel="stylesheet" href="\CSS\record.css">
</head>

<body>
    <!-- 頁首和導覽列 -->
    <header>
        <nav>
            <div class="logo">
                <a href="/Main.html"><img src="\IMG\icon.png" alt="Logo"></a>
            </div>
            <div class="nav-links">
                <ul>
                    <li><a href="\PAGES\Product.html">最新上架</a></li>
                    <li><a href="\PAGES\search.html">履歷查詢</a></li>
                    <li><a href="/PAGES/upload.html">履歷上架與更新</a></li>
                    <li><a href="#">我的農場</a></li>
                </ul>
            </div>
            <div class="nav-icons">
                <a href="#" class="login-btn">登入</a>
            </div>
        </nav>
    </header>


    <!-- 主要內容區塊 -->
    <main>
        <!-- 查詢頁面 -->
        <div id="searchPage">
            <!-- 查詢表單和推薦農場 -->
            <article class="traceability">
                <div class="intro-container">
                    <div class="intro-content">
                        <h2>履歷查詢</h2>
                        <p>您可以透過輸入追溯號碼、選擇農場或輸入產品名稱來查看該產品的詳細履歷資訊。</p>
                        <div class="search-form">
                            <input type="text" placeholder="請輸入追溯號碼">
                            <select>
                                <option value="" disabled selected>選擇農場</option>
                                <option value="farm1">農場 A</option>
                                <option value="farm2">農場 B</option>
                                <option value="farm3">農場 C</option>
                            </select>
                            <input type="text" placeholder="或輸入產品名稱">
                            <button type="submit" id="queryButton">查詢</button>
                        </div>
                    </div>
                    <div class="intro-image">
                        <img src="\IMG\Search\Search_main.png" alt="Traceability Image">
                    </div>
                </div>
            </article>

            <section class="recommended-farms">
                <h2>推薦農場</h2>
                <div class="farm-slider">
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm1.jpg" alt="Farm 1">
                        <h3>東林草莓農場</h3>
                        <p>位於台北市內湖區的白石休閒農業特，以無毒有機施作草莓及夏季蔬果，是個親子假日休閒、體驗食農教育的好所在。</p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm2.jpg" alt="Farm 2">
                        <h3>台塑楊梅有機生態農場</h3>
                        <p>台塑楊梅有機生態農場佔地39公頃，採有機種植蔬果已逾十年，造就農場美好自然生態環境!
                            為推廣有機種植，結合食農教育、環境教育，農場於2021年起開放參觀~
                            歡迎來農場了解有機種植流程、蔬果採摘體驗、餵養咕咕雞，並可DIY種植菜苗小盆栽!</p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm3.jpg" alt="Farm 3">
                        <h3>雲林晁陽綠能休閒農場</h3>
                        <p>亞洲首座寓教於樂的太陽能休閒農場「農電共榮 — 低碳、循環、永續」</p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm4.jpg" alt="Farm 1">
                        <h3>仙山生態教育農場</h3>
                        <p>想賞螢但又不想在野外等到天黑再疲累趕回家嗎?仙山生態教育農場空氣清晰環境優美，園內景觀可觀賞到夕陽、雲海，還可住宿及露營。每到賞螢季時，吸引許多上山賞螢的遊客前來，享受被螢火蟲包圍，住上一晚享受山林之夜的寧靜時光。
                        </p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm1.jpg" alt="Farm 1">
                        <h3>東林草莓農場</h3>
                        <p>位於台北市內湖區的白石休閒農業特，以無毒有機施作草莓及夏季蔬果，是個親子假日休閒、體驗食農教育的好所在。</p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm2.jpg" alt="Farm 2">
                        <h3>台塑楊梅有機生態農場</h3>
                        <p>台塑楊梅有機生態農場佔地39公頃，採有機種植蔬果已逾十年，造就農場美好自然生態環境!
                            為推廣有機種植，結合食農教育、環境教育，農場於2021年起開放參觀~
                            歡迎來農場了解有機種植流程、蔬果採摘體驗、餵養咕咕雞，並可DIY種植菜苗小盆栽!</p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm3.jpg" alt="Farm 3">
                        <h3>雲林晁陽綠能休閒農場</h3>
                        <p>亞洲首座寓教於樂的太陽能休閒農場「農電共榮 — 低碳、循環、永續」</p>
                    </div>
                    <div class="farm-item">
                        <img src="\IMG\Search\Farm\Farm4.jpg" alt="Farm 1">
                        <h3>仙山生態教育農場</h3>
                        <p>想賞螢但又不想在野外等到天黑再疲累趕回家嗎?仙山生態教育農場空氣清晰環境優美，園內景觀可觀賞到夕陽、雲海，還可住宿及露營。每到賞螢季時，吸引許多上山賞螢的遊客前來，享受被螢火蟲包圍，住上一晚享受山林之夜的寧靜時光。
                        </p>
                    </div>
                </div>
            </section>
        </div>


        <!-- 結果頁面 -->
        <div id="resultPage" style="display: none;">
            <div class="container my-5">
                <div class="row">
                    <div class="col-md-8 offset-md-2">
                        <div class="banner">
                            <img src="\IMG\main_trace.png" alt="Banner Image">
                        </div>

                        <div class="farm-info-section mb-4">
                            <h3>農場基礎資訊</h3>
                            <table class="farm-table">
                                <!-- 農場基礎資訊 -->
                            </table>
                        </div>
                        <div class="container cal">
                            <div class="calendar">
                                <div class="calendar-header">
                                    <h3>日曆</h3>
                                </div>
                                <div class="calendar-grid" id="calendar-grid"></div>
                            </div>
                            <div class="records-section">
                                <h3>記錄</h3>
                                <div id="records" class="records"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="submit" id="returnButton">返回查詢頁面</button>
            </div>
        </div>


    </main>

    <!-- 頁尾 -->
    <footer>
        <p>&copy; 2023 Cupee 小黃瓜皮股份有限公司</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@4.8.0/dist/web3.min.js"></script>
    <script src="\SCRIPT\trace_info.js"></script>
    <script src="\SCRIPT\script.js"></script>
    <script>
        // 初始化 Web3 實例和合約實例
        // ...

        // 查詢按鈕點擊事件處理程序
        const queryButton = document.getElementById('queryButton');
        queryButton.addEventListener('click', async () => {
            const productIdInput = document.querySelector('input[placeholder="請輸入追溯號碼"]');
            const productId = productIdInput.value;

            if (productId) {
                try {
                    const accounts = await web3.eth.requestAccounts();
                    const records = await contract.methods.getRecords(productId).call({ from: accounts[0] });

                    // 渲染農場基礎資訊和記錄
                    renderFarmInfo(/* 農場基礎資訊 */);
                    renderRecords(records);

                    // 顯示結果頁面,隱藏查詢頁面
                    document.getElementById('searchPage').style.display = 'none';
                    document.getElementById('resultPage').style.display = 'block';
                } catch (error) {
                    console.error('查詢記錄時發生錯誤:', error);
                }
            } else {
                console.error('請輸入農產品編號');
            }
        });

        // 返回按鈕點擊事件處理程序
        const returnButton = document.getElementById('returnButton');
        returnButton.addEventListener('click', () => {
            // 隱藏結果頁面,顯示查詢頁面
            document.getElementById('searchPage').style.display = 'block';
            document.getElementById('resultPage').style.display = 'none';
        });
    </script>
</body>

</html>